@model HavitGroup.Models.Project

@{
 var images = new List<string>();
 if (!string.IsNullOrEmpty(Model.ImagePath)) images.Add(Model.ImagePath);
 if (Model.RelatedImages != null)
 {
 foreach (var ri in Model.RelatedImages.OrderBy(i => i.DisplayOrder))
 {
 if (!string.IsNullOrEmpty(ri.ImagePath) && !images.Contains(ri.ImagePath))
 images.Add(ri.ImagePath);
 }
 }
 var carouselId = "projectCarousel-" + Model.Id;
 var thumbsId = "projectThumbs-" + Model.Id;
}

<div class="project-details-modal-body container-fluid px-0">

 <!-- ================= HEADER (PINNED) ================= -->
 <div class="project-header sticky-top bg-white px-4 py-3 border-bottom">
 <div class="d-flex justify-content-between align-items-start">
 <div>
 <h4 class="mb-3">@Model.Title</h4>
 <div class="text-muted small">
 <i class="fas fa-map-marker-alt me-1"></i>
 @Model.Location@if(!string.IsNullOrEmpty(Model.Country)){
 <text>, @Model.Country</text>
 }
 &nbsp;
 <i class="fas fa-calendar ms-3 me-1"></i> @Model.Year
 @if (!string.IsNullOrEmpty(Model.Brand))
 {
 <span class="badge bg-light text-success ms-3 fw-semibold">@Model.Brand</span>
 }
 </div>
 </div>
 <!-- icon-only close button (green icon, no circle) -->
 <button type="button" class="modal-close-icon" data-bs-dismiss="modal" aria-label="Close">
 <i class="fas fa-times" aria-hidden="true"></i>
 </button>
 </div>
 </div>

 <!-- ================= SCROLLABLE CONTENT ================= -->
 <div class="project-scroll-content">

 <!-- ===== Main Image Slider ===== -->
 <div class="mb-3">
 <div id="@carouselId" class="carousel slide" data-bs-ride="carousel">
 <div class="carousel-inner rounded-0">
                    @for (int i = 0; i < images.Count; i++)
 {
 <div class="carousel-item @(i == 0 ? "active" : "")">
 <img src="@images[i]"
 class="d-block w-100 project-main-img"
 alt="@Model.Title - @i" />
 </div>
 }
 </div>

                @if (images.Count > 1)
 {
 <button class="carousel-control-prev" type="button" data-bs-target="#@carouselId" data-bs-slide="prev">
 <span class="carousel-control-prev-icon"></span>
 </button>
 <button class="carousel-control-next" type="button" data-bs-target="#@carouselId" data-bs-slide="next">
 <span class="carousel-control-next-icon"></span>
 </button>
 }
 </div>

 <!-- ===== Thumbnails ===== -->
            @if (images.Count > 1)
 {
 <div id="@thumbsId" class="d-flex gap-2 mt-3 related-thumbs-wrapper px-4">
                    @for (int i = 0; i < images.Count; i++)
 {
 <div class="thumb-wrap">
 <img src="@images[i]"
 data-bs-target="#@carouselId"
 data-bs-slide-to="@i"
 class="img-thumbnail related-thumb"
 alt="thumb-@i" />
 </div>
 }
 </div>
 }
 </div>

        <!-- ===== Content Section ===== -->
        <div class="row gx-5 mx-0 px-4 pb-4">

            <!-- LEFT -->
            <div class="col-lg-8">
                <h6 class="section-title">Project Overview</h6>
                <p class="section-text">@Html.Raw(Model.Description ?? string.Empty)</p>

                @if (!string.IsNullOrEmpty(Model.ScopeOfWork))
                {
                    <h6 class="section-title mt-4">Scope of Work</h6>
                    <p class="section-text">@Html.Raw(Model.ScopeOfWork)</p>
                }
            </div>

            <!-- RIGHT -->
            <div class="col-lg-4">
                <h6 class="section-title mb-3">Project Information</h6>

                <div class="project-info-list">

                    @if (!string.IsNullOrEmpty(Model.Category))
                    {
                        <div class="info-row">
                            <span class="info-label">Category</span>
                            <span class="info-value">@Model.Category</span>
                        </div>
                    }

                    @if (!string.IsNullOrEmpty(Model.Client))
                    {
                        <div class="info-row">
                            <span class="info-label">Client</span>
                            <span class="info-value">@Model.Client</span>
                        </div>
                    }

                    <div class="info-row">
                        <span class="info-label">Location</span>
                        <span class="info-value">
                            @Model.Location@if(!string.IsNullOrEmpty(Model.Country)){
                            <text>, @Model.Country</text>
                                                        }
                        </span>
                    </div>

                    <div class="info-row">
                        <span class="info-label">Year Completed</span>
                        <span class="info-value">@Model.Year</span>
                    </div>

                    @if (!string.IsNullOrEmpty(Model.Area))
                    {
                        <div class="info-row">
                            <span class="info-label">Area</span>
                            <span class="info-value">@Model.Area</span>
                        </div>
                    }

                    @if (!string.IsNullOrEmpty(Model.Brand))
                    {
                        <div class="info-row">
                            <span class="info-label">Brand</span>
                            <span class="info-value">@Model.Brand</span>
                        </div>
                    }

                </div>
            </div>

        </div>



 <!-- bottom close bar -->
 <div class="project-bottom-bar bg-light p-3 border-top">
 <div class="container-fluid px-4 d-flex justify-content-end">
 <button type="button" class="btn btn-outline-success view-all-btn btn-sm" data-bs-dismiss="modal">Close</button>
 </div>
 </div>

<style>
            /* ===== Section Titles ===== */
            .section-title {
                font-size: 14px;
                font-weight: 600;
                margin-bottom: 10px;
                color: #111;
            }

            /* ===== Body Text ===== */
            .section-text {
                color: #6c757d;
                line-height: 1.7;
                font-size: 14px;
                margin-bottom: 0;
                text-align: justify;
            }

            /* ===== Right Info Column ===== */
            .project-info-list {
                display: flex;
                flex-direction: column;
                gap: 18px;
            }

            .info-row {
                display: flex;
                flex-direction: column;
                padding-left: 14px;
                border-left: 5px solid #1f5f36;
            }

            .info-label {
                font-size: 12px;
                color: #8c8c8c;
                margin-bottom: 2px;
            }

            .info-value {
                font-size: 14px;
                font-weight: 500;
                color: #111;
            }

 /* ===== FORCE MODAL TO FULL WIDTH ===== */
 .modal-dialog {
        max-width: 95vw !important;
        margin: 1rem auto;
 }

 .modal-content {
        border-radius: 16px;
 }

 /* Icon-only close button (green X) */
 .modal-close-icon {
 background: transparent;
 border: none;
                color: #1f5f36; /* brand green */
 font-size:18px;
 padding:6px;
 display: inline-flex;
 align-items: center;
 justify-content: center;
}
.modal-close-icon:hover,
.modal-close-icon:focus {
 color: #1f5f36; /* darker green on hover */
 background: rgba(0,0,0,0.02);
 border-radius:4px;
 text-decoration: none;
}

/* Ensure bottom close uses same view-all-btn spacing */
.project-bottom-bar .view-all-btn {
 padding:0.5rem1.6rem;
 border-radius:50px;
 font-weight:600;
 }

 /* ===== FULL WIDTH BODY ===== */
 .project-details-modal-body {
        width: 100%;
        max-width: 100%;
        padding: 0;
 overflow: hidden;
 }

 /* Sticky header */
 .project-header {
        z-index: 1055;
 }


 /* Scroll container */
 .project-scroll-content {
        max-height: 78vh;
 overflow-y: auto;
 overflow-x: hidden;
 }

 /* Main image frame + decoration rings */
 .project-main-frame {
 border-radius:12px;
 display: inline-block;
 padding:12px; /* space for outer rings */
 background: linear-gradient(180deg, rgba(0,0,0,0.02), rgba(255,255,255,0.02));
 box-shadow:010px30px rgba(0,0,0,0.06);
 }

 .project-main-img {
 height:95vh;
 max-height:1000px;
 object-fit: cover;
 border-radius:8px;
 display: block;
 box-shadow:0006px rgba(255,255,255,0.6),00010px rgba(41,78,52,0.06);
 }

 /* Thumbnails decoration */
 .related-thumbs-wrapper {
 overflow-x: auto;
 padding-bottom:4px;
 }

 .thumb-wrap {
 flex:00 auto;
 width:180px;
 }

 .related-thumb-frame {
 padding:6px; /* small ring space */
 border-radius:10px;
 transition: transform .12s ease;
 }

 .related-thumb {
 width:100%;
        height:230px;
 object-fit: cover;
 border-radius:8px;
 cursor: pointer;
 border:2px solid transparent !important;
 transition: .15s ease;
 }

    /* Only show green border when hovered or selected */
        .related-thumb:hover {
            /* enforce visible green border when hovered or explicitly selected */
                    border-color: #1f5f36 !important;
            box-shadow: 06px18px rgba(0,0,0,.08) !important;
        }
,
 .related-thumb.selected {
                    border-color: #1f5f36 !important;
 box-shadow:06px18px rgba(0,0,0,.08) !important;
 }

 .related-thumb:focus { outline: none !important; border-color: transparent !important; box-shadow: none !important; }

    /* Right info sticky */
    .project-info-card {
        position: sticky;
        top: 96px;
 }

    /* Mobile */
    @@media (max-width: 767px) {
        .project-main-img

    {
        height: 400px;
 }

 .related-thumb {
        height: 120px;
 }

    .project-scroll-content {
        max-height: 70vh;
    }

 }
</style>

<script>
 (function () {
 var carouselEl = document.getElementById('@carouselId');
 var thumbsEl = document.getElementById('@thumbsId');
 if (!carouselEl) return;

 // Clear any selected classes immediately (defensive)
 if (thumbsEl) {
 thumbsEl.querySelectorAll('.related-thumb').forEach(function (t) { t.classList.remove('selected'); if (t.blur) t.blur(); });
 }

 // Also clear after a short delay to avoid race conditions with Bootstrap or server-side classes
 setTimeout(function () {
 if (thumbsEl) {
 thumbsEl.querySelectorAll('.related-thumb').forEach(function (t) { t.classList.remove('selected'); if (t.blur) t.blur(); });
 }
 },120);

 // Update selected thumbnail when main carousel changes
 carouselEl.addEventListener('slid.bs.carousel', function (e) {
 if (!thumbsEl) return;

 thumbsEl.querySelectorAll('.related-thumb')
 .forEach(t => t.classList.remove('selected'));

 // Add selected only if user navigates slider
 var sel = thumbsEl.querySelectorAll('.related-thumb')[Array.from(carouselEl.querySelectorAll('.carousel-item')).indexOf(e.relatedTarget)];
 if (sel) sel.classList.add('selected');
 });


 // Click on thumbnail to select + move carousel
 if (thumbsEl) {
 thumbsEl.addEventListener('click', function (ev) {
 var t = ev.target.closest('.related-thumb');
 if (!t) return;

 thumbsEl.querySelectorAll('.related-thumb')
 .forEach(x => x.classList.remove('selected'));
 t.classList.add('selected');

 // Move main carousel to clicked thumbnail
 var slideIndex = Array.from(thumbsEl.querySelectorAll('.related-thumb')).indexOf(t);
 var carousel = bootstrap.Carousel.getInstance(carouselEl);
 carousel.to(slideIndex);
 });
 }
 })();
</script>
